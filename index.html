<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>WCPL Season 2 Stats</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --navy: #0f1f3a;
      --green: #7aa64a;
      --blue: #1e3a8a;
      --red: #7f1d1d;
      --bg: #f4f6f8;
    }

    body {
      font-family: system-ui, sans-serif;
      background: var(--bg);
      margin: 0;
      color: #1f2933;
      text-align: center;
    }

    header {
      background: linear-gradient(135deg, var(--navy), #0b162b);
      color: white;
      padding: 24px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }

    header img { height: 70px; }

    header h1 {
      margin: 0;
      font-size: 28px;
      font-weight: 700;
    }

    main {
      max-width: 1400px;
      margin: auto;
      padding: 30px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .controls {
      background: white;
      padding: 20px 24px;
      border-radius: 12px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.08);
      display: flex;
      gap: 12px;
      justify-content: center;
      align-items: center;
    }

    .file-label, button {
      padding: 10px 18px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      border-radius: 8px;
      border: none;
      background: var(--green);
      color: white;
    }

    .file-label input { display: none; }

    h2 {
      margin-top: 50px;
      margin-bottom: 12px;
    }

    table {
      margin: 0 auto 24px auto;
      border-collapse: collapse;
      background: white;
      font-size: 13px;
    }

    th, td {
      padding: 6px 10px;
      border: 1px solid #d1d5db;
      white-space: nowrap;
    }

    .blue th { background: var(--blue); color: white; }
    .red th { background: var(--red); color: white; }

    .totals {
      font-weight: 700;
      background: #e5e7eb;
    }

    footer {
      padding: 20px;
      font-size: 12px;
      color: #6b7280;
    }

    .hint {
      font-size: 12px;
      color: #374151;
      margin-bottom: 8px;
    }
  </style>
</head>
<body>

<header>
  <img src="wcpl logo.png" alt="WCPL Logo" />
  <h1>WCPL Season 2 Stats</h1>
</header>

<main>
  <div class="controls">
    <label class="file-label">
      Choose Files (up to 3)
      <input type="file" id="fileInput" accept=".json" multiple />
    </label>
    <button onclick="convert()">Convert Stats</button>
  </div>

  <div class="hint">Tip: You can select any table, copy, and paste directly into Excel.</div>

  <div id="tables"></div>
</main>

<footer>
  WCPL â€¢ Season 2
</footer>

<script>
let gameCounter = 1;

function convert() {
  const files = [...fileInput.files].slice(0,3);
  if (!files.length) return alert('Select up to 3 JSON files');

  tables.innerHTML = '';
  gameCounter = 1;

  files.forEach(file => {
    const gameNumber = gameCounter++;
    const reader = new FileReader();
    reader.onload = e => {
      const json = JSON.parse(e.target.result);
      tables.innerHTML += `<h2>Game ${gameNumber}</h2>`;
      renderTeam('Blue', json.players);
      renderTeam('Red', json.players);
    };
    reader.readAsText(file);
  });
}

function renderTeam(team, players) {
  const skaters = players.filter(p => p.team === team && p.position !== 'G');
  const goalie = players.find(p => p.team === team && p.position === 'G');
  buildSkaters(`${team} Skaters`, skaters, team);
  if (goalie) buildGoalie(`${team} Goalie`, goalie, team);
}

function sum(data, key) {
  return data.reduce((t,p)=>t+(p[key]||0),0);
}

function buildSkaters(title, data, team) {
  if (!data.length) return;
  const cls = team === 'Blue' ? 'blue' : 'red';

  let html = `<h3>${title}</h3><table class="${cls}"><tr>
    <th>Name</th><th>Pos</th><th>G</th><th>A</th><th>SOG</th><th>Pass</th>
    <th>Ex</th><th>Ent</th><th>TO</th><th>TK</th><th>Touches</th><th>TOI</th><th>+/-</th>
  </tr>`;

  data.forEach(p => html += `<tr>
    <td>${p.name}</td><td>${p.position}</td><td>${p.goals}</td><td>${p.assists}</td>
    <td>${p.sog}</td><td>${p.passes}</td><td>${p.exits}</td><td>${p.entries}</td>
    <td>${p.turnovers}</td><td>${p.takeaways}</td><td>${p.puckTouches}</td>
    <td>${p.timeOnIce}</td><td>${p.plusMinus ?? ''}</td>
  </tr>`);

  html += `<tr class="totals">
    <td>TEAM TOTALS</td><td></td>
    <td>${sum(data,'goals')}</td><td>${sum(data,'assists')}</td><td>${sum(data,'sog')}</td>
    <td>${sum(data,'passes')}</td><td>${sum(data,'exits')}</td><td>${sum(data,'entries')}</td>
    <td>${sum(data,'turnovers')}</td><td>${sum(data,'takeaways')}</td>
    <td>${sum(data,'puckTouches')}</td><td>${sum(data,'timeOnIce')}</td><td>${sum(data,'plusMinus')}</td>
  </tr></table>`;

  tables.innerHTML += html;
}

function buildGoalie(title, g, team) {
  const cls = team === 'Blue' ? 'blue' : 'red';
  tables.innerHTML += `<h3>${title}</h3><table class="${cls}"><tr>
    <th>Name</th><th>Shots</th><th>Saves</th><th>GA</th><th>SV%</th>
  </tr><tr>
    <td>${g.name}</td><td>${g.shotsFaced}</td><td>${g.saves}</td>
    <td>${g.goalsAllowed}</td><td>${(g.saveperc*100).toFixed(1)}</td>
  </tr></table>`;
}
</script>

</body>
</html>
